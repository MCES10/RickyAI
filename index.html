<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Learning AI</title>
</head>
<body>
    <h1>Simple Learning AI</h1>
    
    <div id="chatHistory"></div>

    <label for="userInput">User Input:</label>
    <input type="text" id="userInput">
    <button onclick="submitUserInput()">Submit</button>

    <h2>AI Response:</h2>
    <p id="aiResponse"></p>

    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-firestore.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAOll73Mr1n4FjdRKWP0hbNVO3hplCGoXM",
            authDomain: "rickyartificialintelligence.firebaseapp.com",
            projectId: "rickyartificialintelligence",
            storageBucket: "rickyartificialintelligence.appspot.com",
            messagingSenderId: "582135176188",
            appId: "1:582135176188:web:08e5a4a37f283c2f22f079",
            measurementId: "G-3BT3T8GD0Z"
        };

        firebase.initializeApp(firebaseConfig);

        const db = firebase.firestore();
        let knowledgeBase = {};
        let chatHistory = [];

        function submitUserInput() {
            const userInput = document.getElementById('userInput').value.toLowerCase();
            const aiResponseElement = document.getElementById('aiResponse');
            const chatHistoryElement = document.getElementById('chatHistory');

            chatHistory.push({ role: 'user', text: userInput });

            if (knowledgeBase.hasOwnProperty(userInput)) {
                const aiResponse = knowledgeBase[userInput];
                aiResponseElement.textContent = aiResponse;
                chatHistory.push({ role: 'ai', text: aiResponse });
                updateChatHistoryUI(chatHistoryElement);
            } else {
                const userResponse = prompt('I do not know the answer. Please teach me. What should I say in response to "' + userInput + '"?');
                
                knowledgeBase[userInput] = userResponse;
                aiResponseElement.textContent = userResponse;
                chatHistory.push({ role: 'ai', text: userResponse });
                updateChatHistoryUI(chatHistoryElement);

                // Save the knowledge base to Firestore
                saveKnowledgeBaseToFirestore();
            }
        }

        function saveKnowledgeBaseToFirestore() {
            db.collection('knowledgeBase').doc('data').set({
                knowledgeBase: knowledgeBase
            })
            .then(() => {
                console.log('Knowledge base saved to Firestore');
            })
            .catch(error => {
                console.error('Error saving knowledge base:', error);
            });
        }

        function loadKnowledgeBaseFromFirestore() {
            db.collection('knowledgeBase').doc('data').get()
                .then(doc => {
                    if (doc.exists) {
                        knowledgeBase = doc.data().knowledgeBase || {};
                    } else {
                        console.log('No knowledge base data found in Firestore');
                    }
                })
                .catch(error => {
                    console.error('Error loading knowledge base:', error);
                });
        }

        function updateChatHistoryUI(chatHistoryElement) {
            chatHistoryElement.innerHTML = '';
            chatHistory.forEach(entry => {
                const entryElement = document.createElement('div');
                entryElement.classList.add(entry.role);
                entryElement.textContent = entry.text;
                chatHistoryElement.appendChild(entryElement);
            });
        }

        // Load the knowledge base from Firestore on page load
        window.onload = function() {
            loadKnowledgeBaseFromFirestore();
        };
    </script>
</body>
</html>
